<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
	<body>
    <h1 id="queryTitle">"<span id="queryPlaceholder">Say anything</span>"</h1>

    <div id="imageContainer"></div> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        if (annyang) {
             // Initialize audio elements 

        // Annyang callback for sound detection start

	@@ -161,92 +163,104 @@ <h1 id="queryTitle">"<span id="queryPlaceholder">Say anything</span>"</h1>
            };
            let displayedImages = [];
            let displayedTitles = [];
const showImages = function(tag) {
            tag = tag.replace(/\.$/, ''); // Clean the tag
            document.getElementById('queryPlaceholder').textContent = tag;
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.innerHTML = ''; // Clear the container
            fetchImages(tag, 'en'); // Fetch images starting with English
        };

        const fetchImages = function(tag, lang) {
            const url = `https://${lang}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(tag)}&format=json&origin=*`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.query.search.length > 0) {
                        const title = data.query.search[0].title;
                        getImage(title, lang);
                    } else {
                        appendNoResults(lang);
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    appendError(lang);
                });
        };

        const getImage = function(title, lang) {
            const url = `https://${lang}.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(title)}&prop=pageimages|info&inprop=url&pithumbsize=500&format=json&origin=*`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const pages = data.query.pages;
                    const pageId = Object.keys(pages)[0];
                    if (pages[pageId].thumbnail) {
                        appendImage(pages[pageId].thumbnail.source, pages[pageId].fullurl, title, lang);
                    }
                })
                .catch(error => {
                    console.error('Image fetch error:', error);
                    appendError(lang);
                });
        };

        const appendImage = function(src, link, title, lang) {
            const imageContainer = document.getElementById('imageContainer');
            const imageGroup = document.createElement('div');
            imageGroup.className = 'image-group';
            const imageBox = document.createElement('div');
            imageBox.className = 'image-box';
            const imageLink = document.createElement('a');
            imageLink.href = link;
            imageLink.target = '_blank';
            const img = document.createElement('img');
            img.src = src;
            img.alt = `Picture of ${title}`;
            const imageTitle = document.createElement('div');
            imageTitle.className = 'image-title';
            imageTitle.textContent = `${title} (${langNames[lang]})`;

            imageLink.appendChild(img);
            imageLink.appendChild(imageTitle);
            imageBox.appendChild(imageLink);
            imageGroup.appendChild(imageBox);
            imageContainer.appendChild(imageGroup);
        };

        const appendNoResults = function(lang) {
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.innerHTML = `<p>No results found for "${tag}" in ${langNames[lang]}.</p>`;
        };

        const appendError = function(lang) {
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.innerHTML = `<p>Error retrieving information for ${langNames[lang]}.</p>`;
        };

        const commands = {
            '*tag': showImages
        };
console.log(commands);
        annyang.addCommands(commands);
        annyang.start({ autoRestart: true, continuous: false });
    } else {
        document.getElementById('imageContainer').innerHTML = "<p>Your browser does not support voice recognition.</p>";
    }
    </script>
		</body>
</html>
